(()=>{"use strict";const e={HERO:7,LEGEND:11,RELIC:15,ANCIENT:17},t={HERO:[10],LEGEND:[10,14],RELIC:[10,14,17,18,19,20],ANCIENT:[10,14,17,18,19,20]},o={dealer:new Set(["atk","add","boss"]),support:new Set(["brand","allyDmg","allyAtk"])},r={atk:1,add:1,boss:1,brand:1,allyDmg:1,allyAtk:1};function n(e){const t={...r};return e?(Object.keys(t).forEach(o=>{const n=e[o],l="number"===typeof n?n:Number(n);t[o]=Number.isFinite(l)&&l>=0?l:r[o]}),t):t}function*l(e,t){const o=e.length;if(t>o)return;const r=Array.from({length:t},(e,t)=>t);for(;;){yield r.map(t=>e[t]);let n=t-1;for(;n>=0&&r[n]===o-t+n;)n--;if(n<0)break;r[n]++;for(let e=n+1;e<t;e++)r[e]=r[e-1]+1}}function i(e,r,n,l){const i=e.reduce((e,t)=>{var o;return e+(null!==(o=t.will)&&void 0!==o?o:0)},0),s=e.reduce((e,t)=>{var o;return e+(null!==(o=t.point)&&void 0!==o?o:0)},0),c=function(e,o){return t[e].filter(e=>o>=e)}(r,s),a=e.reduce((e,t)=>e+function(e,t,r){var n,l,i,s;if(null==t)return 0;const c="dealer"===t?o.dealer:o.support;return(c.has(e.o1k)?(null!==(n=e.o1v)&&void 0!==n?n:0)*(null!==(l=r[e.o1k])&&void 0!==l?l:1):0)+(c.has(e.o2k)?(null!==(i=e.o2v)&&void 0!==i?i:0)*(null!==(s=r[e.o2k])&&void 0!==s?s:1):0)}(t,n,l),0);return{totalWill:i,totalPoint:s,thr:c,roleSum:a,score:1e7*c.length+1e4*s+10*(5e3-i)+a-e.length}}function s(o,r,s,c,a,u,h){const d=e[r],m=n(c),f=[],p=Math.min(4,o.length);for(let e=0;e<=p;e++)if(0!==e)for(const t of l(o,e)){h&&h(1);const e=t.reduce((e,t)=>e+(t.will||0),0);if(e>d)continue;const{totalPoint:o,thr:n,roleSum:l,score:c}=i(t,r,s,m);f.push({list:t,totalWill:e,totalPoint:o,thr:n,roleSum:l,score:c})}else f.push({list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0});let g;if(f.sort((e,t)=>t.score-e.score),u){const e=Math.min(...t[r]),o=null!==a&&void 0!==a?a:e;g=f.filter(e=>e.totalPoint>=o&&e.thr.length>0&&e.list.length>0)}else g=null!=a?f.filter(e=>e.totalPoint===a&&e.list.length>0):f.filter(e=>e.thr.length>0&&e.list.length>0);return 0===g.length?[{list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0}]:g}const c=e=>{var t;return null!==e&&void 0!==e&&null!==(t=e.thr)&&void 0!==t&&t.length?Math.max(...e.thr):0},a=e=>Math.min(...t[e]),u=()=>{var e,t,o;return null!==(e=null===(t=globalThis.performance)||void 0===t||null===(o=t.now)||void 0===o?void 0:o.call(t))&&void 0!==e?e:Date.now()},h=e=>new Promise(t=>setTimeout(t,e));function d(e,t){for(const o of e.list)if(t.has(o.id))return!0;return!1}const m=(e,t)=>{const o=c(e),r=c(t);return o!==r?r-o:e.totalPoint!==t.totalPoint?t.totalPoint-e.totalPoint:e.roleSum!==t.roleSum?t.roleSum-e.roleSum:e.totalWill-t.totalWill};async function f(e){let{cores:t,pool:o,role:r,weights:n,perCoreLimit:l,emitOverall:i}=e;const c=o.length,a=Math.min(4,c),d=Array.from({length:a},(e,t)=>((e,t)=>{let o=1;for(let r=1;r<=t;r++)o=o*(e-r+1)/r;return Math.floor(o)})(c,t+1)).reduce((e,t)=>e+t,0),f=d*t.length;let p=0;const g=[],v={coreIndex:0,coreCount:t.length,coreDone:0,coreTotal:0,t0:0},S=()=>{var e;p+=1,v.coreDone+=1;const o=u()-v.t0,r=o>=250&&v.coreDone>=Math.min(1e3,.05*v.coreTotal),n=r?v.coreDone/(o/1e3):null,l=r&&n?1e3*Math.max(0,(v.coreTotal-v.coreDone)/n):null;null===i||void 0===i||i({type:"progress",phase:"gen",label:`\ud6c4\ubcf4 \uc0dd\uc131 \uc911\u2026 (${(null===(e=t[v.coreIndex-1])||void 0===e?void 0:e.name)||`\ucf54\uc5b4 ${v.coreIndex}`})`,indeterminate:!1,done:p,total:f,coreIndex:v.coreIndex,coreCount:v.coreCount,coreDone:v.coreDone,coreTotal:v.coreTotal,rate:n,elapsedMs:o,etaMs:l})};for(let T=0;T<t.length;T++){const e=t[T];v.coreIndex=T+1,v.coreDone=0,v.coreTotal=d,v.t0=u(),null===i||void 0===i||i({type:"progress",phase:"gen",label:`\ud6c4\ubcf4 \uc0dd\uc131 \uc911\u2026 (${e.name||`\ucf54\uc5b4 ${v.coreIndex}`})`,indeterminate:!1,done:p,total:f,coreIndex:v.coreIndex,coreCount:v.coreCount,coreDone:v.coreDone,coreTotal:v.coreTotal},!0),await h(0);const c=s(o,e.grade,r,n,e.minThreshold,e.enforceMin,S).filter(e=>e.list.length>0&&e.thr.length>0).sort(m).slice(0,l);g[T]=c,null===i||void 0===i||i({type:"progress",phase:"gen",label:`\ud6c4\ubcf4 \uc0dd\uc131 \uc911\u2026 (${e.name||`\ucf54\uc5b4 ${v.coreIndex}`})`,indeterminate:!1,done:p,total:f,coreIndex:v.coreIndex,coreCount:v.coreCount,coreDone:v.coreTotal,coreTotal:v.coreTotal},!0),await h(0)}return{candidatesPerCore:g,totalGenAll:f,doneCombos:p}}async function p(e){let{cores:t,pool:o,role:r,weights:n,perCoreLimit:l,emit:i}=e;const s=t.map((e,t)=>t),h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,o=0;return function(r){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const l=u();(n||l-o>=t)&&(o=l,e(r))}}(i,24),{candidatesPerCore:m}=await f({cores:t,pool:o,role:r,weights:n,perCoreLimit:l,emitOverall:h}),p=m;let g=0;const v=function(){g++,h({type:"progress",phase:"search",label:"\ucd5c\uc801 \ubc30\uce58 \ud0d0\uc0c9 \uc911\u2026",indeterminate:!0,pulse:g},arguments.length>0&&void 0!==arguments[0]&&arguments[0])};v(!0);const S={list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0};function T(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set,r=null;const n=new Set;return function l(i,u,h,m,f,g,S,T){var w;if(v(),i===s.length){for(const r of e){var y;const e=null!==(y=t[r].minThreshold)&&void 0!==y?y:a(t[r].grade);if(c(u[r])<e)return}const o={picks:u.map(e=>e),sumThr:h,sumPoint:m,sumWill:f,roleSum:g,thrVec:S.slice(),ptVec:T.slice()};return void(((e,t)=>{if(!t)return!0;if(e.sumThr!==t.sumThr)return e.sumThr>t.sumThr;for(let o=0;o<e.thrVec.length;o++)if(e.thrVec[o]!==t.thrVec[o])return e.thrVec[o]>t.thrVec[o];if(e.sumPoint!==t.sumPoint)return e.sumPoint>t.sumPoint;for(let o=0;o<e.ptVec.length;o++)if(e.ptVec[o]!==t.ptVec[o])return e.ptVec[o]>t.ptVec[o];return e.roleSum!==t.roleSum?e.roleSum>t.roleSum:e.sumWill!==t.sumWill&&e.sumWill<t.sumWill})(o,r)&&(r=o))}const P=s[i],k=e.has(P),C=k?null!==(w=t[P].minThreshold)&&void 0!==w?w:a(t[P].grade):-1/0;if(o.has(P))return void l(i+1,u,h,m,f,g,S,T);const b=p[i]||[];for(const e of b){const t=c(e);if(k&&t<C)continue;if(d(e,n))continue;e.list.forEach(e=>n.add(e.id));const o=u[P];u[P]=e,S[i]=t,T[i]=e.totalPoint,l(i+1,u,h+t,m+e.totalPoint,f+e.totalWill,g+e.roleSum,S,T),e.list.forEach(e=>n.delete(e.id)),u[P]=o,S[i]=0,T[i]=0}k||l(i+1,u,h,m,f,g,S,T)}(0,t.map(()=>S),0,0,0,0,Array(s.length).fill(0),Array(s.length).fill(0)),r}const w=t.map((e,t)=>e.enforceMin?t:-1).filter(e=>-1!==e),y=new Set(w),P=T(y);if(P)return{picks:P.picks};if(s.length>0){const e=s[s.length-1];if(y.has(e)){const t=T(new Set([...y].filter(t=>t!==e)),new Set([e]));if(t){return{picks:t.picks.map((t,o)=>o===e?S:t||S)}}}}const k=new Set;for(const u of w){var C;const e=null!==(C=t[u].minThreshold)&&void 0!==C?C:a(t[u].grade),o=s.indexOf(u);(p[o]||[]).some(t=>c(t)>=e)||k.add(u)}const b=T(new Set(w.filter(e=>!k.has(e))));if(b){return{picks:b.picks.map((e,t)=>k.has(t)?S:e||S)}}return{picks:t.map(()=>S)}}globalThis.onmessage=async e=>{const{type:t="run",cores:o,gems:r,role:l,weights:i,perCoreLimit:s}=e.data,c=e=>globalThis.postMessage(e);try{if("kickoff"===t)return;c({type:"result",...await p({cores:o,pool:r,role:l,weights:n(i),perCoreLimit:s,emit:c})})}catch(a){console.error("Worker error:",a),c({type:"error",error:String((null===a||void 0===a?void 0:a.message)||a)})}}})();
//# sourceMappingURL=290.d8e154ba.chunk.js.map