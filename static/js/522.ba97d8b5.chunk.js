(()=>{"use strict";var t={4141:(t,e,a)=>{var n=a(1257),o=a.n(n);const r=(t,e)=>{"error"===t&&e instanceof Error?postMessage({type:t,payload:{code:e.code||"UNKNOWN",message:e.message,stack:e.stack}}):postMessage({type:t,payload:e})};async function i(t){const e=new OffscreenCanvas(t.width,t.height),a=e.getContext("2d",{alpha:!1});return a.imageSmoothingEnabled=!1,a.drawImage(t,0,0),await e.convertToBlob({type:"image/png",quality:.95})}async function l(t,e,a,n,o){const r=Math.max(1,Math.round(n)),i=Math.max(1,Math.round(o)),l=new OffscreenCanvas(r,i),s=l.getContext("2d",{alpha:!1});s.imageSmoothingEnabled=!1,s.drawImage(t,e,a,n,o,0,0,r,i);const c=await l.convertToBlob({type:"image/png",quality:.95});return{blob:c,url:URL.createObjectURL(c),W:r,H:i,canvas:l,ctx:s}}async function s(t){let{invert:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=t.width,n=t.height,o=new OffscreenCanvas(2*a,2*n),r=o.getContext("2d",{willReadFrequently:!0});r.imageSmoothingEnabled=!1,r.drawImage(t,0,0,a,n,0,0,o.width,o.height);const i=r.getImageData(0,0,o.width,o.height),l=i.data;for(let w=0;w<l.length;w+=4){const t=.299*l[w]+.587*l[w+1]+.114*l[w+2];l[w]=l[w+1]=l[w+2]=t}if(e)for(let w=0;w<l.length;w+=4)l[w]=l[w+1]=l[w+2]=255-l[w];const s=new Array(256).fill(0);for(let w=0;w<l.length;w+=4)s[0|l[w]]++;const c=o.width*o.height;let d=0;for(let w=0;w<256;w++)d+=w*s[w];let h=0,u=0,g=0,m=127;for(let w=0;w<256;w++){if(u+=s[w],!u)continue;const t=c-u;if(!t)break;h+=w*s[w];const e=u*t*(h/u-(d-h)/t)**2;e>g&&(g=e,m=w)}for(let w=0;w<l.length;w+=4){const t=l[w]-m;let e=Math.abs(t)>=50?t>0?255:0:Math.round((t+50)/100*255);l[w]=l[w+1]=l[w+2]=e,l[w+3]=255}r.putImageData(i,0,0);const v=await o.convertToBlob({type:"image/png",quality:.95});return await createImageBitmap(v)}async function c(t,e,a,n){let{psm:r=7,whitelist:i=""}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const l={tessedit_pageseg_mode:r,preserve_interword_spaces:"1",logger:t=>{"recognizing text"===t.status&&"number"===typeof t.progress&&(null===n||void 0===n||n(`${a}\u2026`,!1,Math.round(100*t.progress)))}};i&&(l.tessedit_char_whitelist=i);const{data:s}=await o().recognize(t,e,l),c=[],d=t=>{var e,a,n,o,r,i,l,s,d,h,u,g,m,v;if(null===t||void 0===t||!t.text||null===t||void 0===t||!t.bbox)return;const w=String(t.text).trim();if(!w)return;const f={x:null!==(e=null===(a=t.bbox)||void 0===a?void 0:a.x0)&&void 0!==e?e:0,y:null!==(n=null===(o=t.bbox)||void 0===o?void 0:o.y0)&&void 0!==n?n:0,w:(null!==(r=null===(i=t.bbox)||void 0===i?void 0:i.x1)&&void 0!==r?r:0)-(null!==(l=null===(s=t.bbox)||void 0===s?void 0:s.x0)&&void 0!==l?l:0),h:(null!==(d=null===(h=t.bbox)||void 0===h?void 0:h.y1)&&void 0!==d?d:0)-(null!==(u=null===(g=t.bbox)||void 0===g?void 0:g.y0)&&void 0!==u?u:0)},x=null!==(m=null!==(v=t.confidence)&&void 0!==v?v:t.conf)&&void 0!==m?m:null;c.push({text:w,bbox:f,conf:x})};if(Array.isArray(null===s||void 0===s?void 0:s.words))for(const o of s.words)d(o);return{words:c,rawText:(null===s||void 0===s?void 0:s.text)||""}}function d(t,e){const a=t.x+t.w,n=t.y+t.h,o=e.x+e.w,r=e.y+e.h,i=Math.max(t.x,e.x),l=Math.max(t.y,e.y),s=Math.min(a,o),c=Math.min(n,r),d=Math.max(0,s-i)*Math.max(0,c-l),h=t.w*t.h+e.w*e.h-d;return h>0?d/h:0}function h(t){let{iouThresh:e=.6}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=[];for(const n of t||[])a.find(t=>t.text===n.text&&d(t.bbox,n.bbox)>=e)||a.push(n);return a}self.onmessage=async t=>{const{type:e,payload:a}=t.data||{};if("scan"!==e)return;const{buf:n,mime:o="image/png",lang:d="kor+eng",rect:u,excludes:g=[]}=a||{};if(!n)return r("error",{code:"NO_IMAGE",message:"no image buffer"});if(!u||!Number.isFinite(u.x)||!Number.isFinite(u.y)||!Number.isFinite(u.w)||!Number.isFinite(u.h))return r("error",{code:"NO_ROI",message:"manual ROI(rect) is required"});let m;try{m=await createImageBitmap(new Blob([n],{type:o}))}catch(f){return r("error",{code:"DECODE_FAIL",message:"\uc774\ubbf8\uc9c0\ub97c \ub514\ucf54\ub4dc\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",detail:String(f)})}try{const t=m.width,e=m.height,a={x:Math.max(0,Math.min(t-1,Math.round(u.x))),y:Math.max(0,Math.min(e-1,Math.round(u.y))),w:Math.max(1,Math.min(t,Math.round(u.w))),h:Math.max(1,Math.min(e,Math.round(u.h)))},n=await(async()=>{const a=new OffscreenCanvas(t,e);return a.getContext("2d",{alpha:!1}).drawImage(m,0,0),await a.convertToBlob({type:"image/png",quality:.95})})(),o=await async function(t,e){const a=t instanceof ImageBitmap?t:await createImageBitmap(t),{x:n,y:o,w:r,h:i}=e;return await l(a,n,o,r,i)}(n,a);await async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(null===e||void 0===e||!e.length)return;const a=t.getContext("2d",{alpha:!1});a.save(),a.fillStyle="#000",e.forEach(t=>{if(!t)return;const e=Math.max(0,Math.round(t.x)),n=Math.max(0,Math.round(t.y)),o=Math.max(1,Math.round(t.w)),r=Math.max(1,Math.round(t.h));a.fillRect(e,n,o,r)}),a.restore()}(o.canvas,(g||[]).map(t=>({x:t.x-a.x,y:t.y-a.y,w:t.w,h:t.h})));const v=(t,e,a)=>r("progress",{label:t,indeterminate:!!e,pct:null!==a&&void 0!==a?a:0}),w=await async function(t,e,a){const n=t.width,o=t.height,r=await createImageBitmap(await t.convertToBlob({type:"image/png",quality:.95})),d=Math.max(20,Math.round(.22*n)),u=Math.round(.06*n),g=Math.min(n-1,d+u),m=Math.max(10,n-g),{blob:v}=await l(r,0,0,d,o),{blob:w}=await l(r,g,0,m,o),f=await s(await createImageBitmap(v),{invert:!0}),x=await s(await createImageBitmap(w),{invert:!0}),p=URL.createObjectURL(await i(f)),b=URL.createObjectURL(await i(x));let y=[],M=[],O="",R="";try{const t=await c(p,e,"\uc67c\ucabd(\uc22b\uc790)",a,{psm:7,whitelist:"123456789"});y=t.words||[],O=t.rawText||"";const n=await c(b,"kor","\uc624\ub978\ucabd(\ub77c\ubca8/Lv)",a,{psm:7,whitelist:"0123456789.Lv\uacf5\uaca9\ub825\ucd94\uac00\ud53c\ud574\ubcf4\uc2a4\ud53c\ud574\uc544\uad70\uacf5\uaca9\uac15\ud654\uc544\uad70\ud53c\ud574\uac15\ud654\ub099\uc778\ub825"});M=n.words||[],R=n.rawText||""}finally{URL.revokeObjectURL(p),URL.revokeObjectURL(b)}var k,I;return{words:h([...y,...(k=h(M),I=g,(k||[]).map(t=>({text:t.text,bbox:{x:t.bbox.x+I,y:t.bbox.y,w:t.bbox.w,h:t.bbox.h},conf:t.conf})))]),leftRaw:O,rightRaw:R,debug:{bands:{W:n,H:o,leftW:d,gapX:u,rightX:g,rightW:m}}}}(o.canvas,d,v),f=await o.blob.arrayBuffer();postMessage({type:"done",payload:{ok:!0,anchor:null,panel:{...a,by:"manual"},imageSize:{w:o.W,h:o.H},words:w.words,joinedWords:(w.words||[]).map(t=>t.text).join(" "),rawLeft:w.leftRaw,rawRight:w.rightRaw,roiPng:f,roiMime:"image/png",debug:w.debug}},[f])}catch(f){r("error",{code:(null===f||void 0===f?void 0:f.code)||"UNKNOWN",message:(null===f||void 0===f?void 0:f.message)||String(f),stack:null===f||void 0===f?void 0:f.stack})}finally{try{var v,w;null===(v=(w=m).close)||void 0===v||v.call(w)}catch{}}}}},e={};function a(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,a),r.exports}a.m=t,a.x=()=>{var t=a.O(void 0,[257],()=>a(4141));return t=a.O(t)},(()=>{var t=[];a.O=(e,n,o,r)=>{if(!n){var i=1/0;for(d=0;d<t.length;d++){n=t[d][0],o=t[d][1],r=t[d][2];for(var l=!0,s=0;s<n.length;s++)(!1&r||i>=r)&&Object.keys(a.O).every(t=>a.O[t](n[s]))?n.splice(s--,1):(l=!1,r<i&&(i=r));if(l){t.splice(d--,1);var c=o();void 0!==c&&(e=c)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[n,o,r]}})(),a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.f={},a.e=t=>Promise.all(Object.keys(a.f).reduce((e,n)=>(a.f[n](t,e),e),[])),a.u=t=>"static/js/"+t+".59e4d394.chunk.js",a.miniCssF=t=>{},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.p="/",(()=>{var t={141:1,522:1};a.f.i=(e,n)=>{t[e]||importScripts(a.p+a.u(e))};var e=self.webpackChunkpeon_calculator=self.webpackChunkpeon_calculator||[],n=e.push.bind(e);e.push=e=>{var o=e[0],r=e[1],i=e[2];for(var l in r)a.o(r,l)&&(a.m[l]=r[l]);for(i&&i(a);o.length;)t[o.pop()]=1;n(e)}})(),(()=>{var t=a.x;a.x=()=>a.e(257).then(t)})();a.x()})();
//# sourceMappingURL=522.ba97d8b5.chunk.js.map