(()=>{"use strict";const t={HERO:7,LEGEND:11,RELIC:15,ANCIENT:17},e={HERO:[10],LEGEND:[10,14],RELIC:[10,14,17,18,19,20],ANCIENT:[10,14,17,18,19,20]},o={dealer:new Set(["atk","add","boss"]),support:new Set(["brand","allyDmg","allyAtk"])},r={boss:1,add:1,atk:1,brand:0,allyDmg:0,allyAtk:0},n={boss:[0,.078,.156,.244,.313,.391],add:[0,.06,.119,.187,.239,.299],atk:[0,.029,.067,.105,.134,.172]},l={brand:[0,.167,.334,.501,.668,.835],allyAtk:[0,.13,.26,.39,.52,.65],allyDmg:[0,.052,.104,.156,.208,.26]};function i(t){const e={...r};return t?(Object.keys(e).forEach(o=>{const n=t[o],l="number"===typeof n?n:Number(n);e[o]=Number.isFinite(l)&&l>=0?l:r[o]}),e):e}function s(t,e,r){const s=i(r||{});let c=0;const a=(t,r)=>{var i;if(!t||!r)return;if(e&&!function(t,e){const r=null===o||void 0===o?void 0:o[t];return!r||(Array.isArray(r)?r.includes(e):r&&"function"===typeof r.has?r.has(e):!r||"object"!==typeof r||!!r[e])}(e,t))return;const a=function(t,e,o){const r=Math.max(0,Math.min(5,Number(o)||0));return"dealer"===t&&n[e]?n[e][r]||0:"support"===t&&l[e]?l[e][r]||0:r}(e,t,r),u=null!==(i=s[t])&&void 0!==i?i:0;c+=a*u};return a(t.o1k,t.o1v),a(t.o2k,t.o2v),c}function*c(t,e){const o=t.length;if(e>o)return;const r=Array.from({length:e},(t,e)=>e);for(;;){yield r.map(e=>t[e]);let n=e-1;for(;n>=0&&r[n]===o-e+n;)n--;if(n<0)break;r[n]++;for(let t=n+1;t<e;t++)r[t]=r[t-1]+1}}function a(t,o,r,n){const l=t.reduce((t,e)=>{var o;return t+(null!==(o=e.will)&&void 0!==o?o:0)},0),i=t.reduce((t,e)=>{var o;return t+(null!==(o=e.point)&&void 0!==o?o:0)},0),c=function(t,o){return e[t].filter(t=>o>=t)}(o,i),a=t.reduce((t,e)=>t+s(e,r,n),0);return{totalWill:l,totalPoint:i,thr:c,roleSum:a,score:1e7*c.length+1e4*i+10*(5e3-l)+a-t.length}}function u(o,r,n,l,s,u,h){const m=t[r],f=i(l),d=[],p=Math.min(4,o.length);for(let t=0;t<=p;t++)if(0!==t)for(const e of c(o,t)){h&&h(1);const t=e.reduce((t,e)=>t+(e.will||0),0);if(t>m)continue;const{totalPoint:o,thr:l,roleSum:i,score:s}=a(e,r,n,f);d.push({list:e,totalWill:t,totalPoint:o,thr:l,roleSum:i,score:s})}else d.push({list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0});let g;if(d.sort((t,e)=>e.score-t.score),u){const t=Math.min(...e[r]),o=null!==s&&void 0!==s?s:t;g=d.filter(t=>t.totalPoint>=o&&t.thr.length>0&&t.list.length>0)}else g=null!=s?d.filter(t=>t.totalPoint===s&&t.list.length>0):d.filter(t=>t.thr.length>0&&t.list.length>0);return 0===g.length?[{list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0}]:g}const h=t=>{var e;return null!==t&&void 0!==t&&null!==(e=t.thr)&&void 0!==e&&e.length?Math.max(...t.thr):0},m=t=>Math.min(...e[t]),f=()=>{var t,e,o;return null!==(t=null===(e=globalThis.performance)||void 0===e||null===(o=e.now)||void 0===o?void 0:o.call(e))&&void 0!==t?t:Date.now()},d=t=>new Promise(e=>setTimeout(e,t));function p(t,e){for(const o of t.list)if(e.has(o.id))return!0;return!1}const g=(t,e)=>{const o=h(t),r=h(e);return o!==r?r-o:t.totalPoint!==e.totalPoint?e.totalPoint-t.totalPoint:t.roleSum!==e.roleSum?e.roleSum-t.roleSum:t.totalWill-e.totalWill};function v(t,e){const o=(t,e)=>{const o=Math.max(0,...t.thr||[]),r=Math.max(0,...e.thr||[]),n=[o,t.totalPoint,t.roleSum,-t.totalWill],l=[r,e.totalPoint,e.roleSum,-e.totalWill];let i=!0,s=!1;for(let c=0;c<n.length;c++)n[c]<l[c]&&(i=!1),n[c]>l[c]&&(s=!0);return i&&s},r=[];t:for(const n of t){for(let t=r.length-1;t>=0;t--){const e=r[t];if(o(e,n))continue t;o(n,e)&&r.splice(t,1)}r.push(n)}if(r.length>e)return r.sort((t,e)=>{const o=Math.max(0,...e.thr||[])-Math.max(0,...t.thr||[]);return o||(e.totalPoint!==t.totalPoint?e.totalPoint-t.totalPoint:e.roleSum!==t.roleSum?e.roleSum-t.roleSum:t.totalWill-e.totalWill)}),r.slice(0,e);if(r.length<e){const o=new Set(r),n=t.filter(t=>!o.has(t)).sort(g);r.push(...n.slice(0,e-r.length))}return r}async function S(t){let{cores:e,pool:o,role:r,weights:n,perCoreLimit:l,emitOverall:i}=t;const s=o.length,c=Math.min(4,s),a=Array.from({length:c},(t,e)=>((t,e)=>{let o=1;for(let r=1;r<=e;r++)o=o*(t-r+1)/r;return Math.floor(o)})(s,e+1)).reduce((t,e)=>t+e,0),h=a*e.length;let m=0;const p=[],g={coreIndex:0,coreCount:e.length,coreDone:0,coreTotal:0,t0:0},S=()=>{var t;m+=1,g.coreDone+=1;const o=f()-g.t0,r=o>=250&&g.coreDone>=Math.min(1e3,.05*g.coreTotal),n=r?g.coreDone/(o/1e3):null,l=r&&n?1e3*Math.max(0,(g.coreTotal-g.coreDone)/n):null;null===i||void 0===i||i({type:"progress",phase:"gen",label:`\ud6c4\ubcf4 \uc0dd\uc131 \uc911\u2026 (${(null===(t=e[g.coreIndex-1])||void 0===t?void 0:t.name)||`\ucf54\uc5b4 ${g.coreIndex}`})`,indeterminate:!1,done:m,total:h,coreIndex:g.coreIndex,coreCount:g.coreCount,coreDone:g.coreDone,coreTotal:g.coreTotal,rate:n,elapsedMs:o,etaMs:l})};for(let y=0;y<e.length;y++){const t=e[y];g.coreIndex=y+1,g.coreDone=0,g.coreTotal=a,g.t0=f(),null===i||void 0===i||i({type:"progress",phase:"gen",label:`\ud6c4\ubcf4 \uc0dd\uc131 \uc911\u2026 (${t.name||`\ucf54\uc5b4 ${g.coreIndex}`})`,indeterminate:!1,done:m,total:h,coreIndex:g.coreIndex,coreCount:g.coreCount,coreDone:g.coreDone,coreTotal:g.coreTotal},!0),await d(0);const s=v(u(o,t.grade,r,n,t.minThreshold,t.enforceMin,S).filter(t=>t.list.length>0&&t.thr.length>0),l);p[y]=s,null===i||void 0===i||i({type:"progress",phase:"gen",label:`\ud6c4\ubcf4 \uc0dd\uc131 \uc911\u2026 (${t.name||`\ucf54\uc5b4 ${g.coreIndex}`})`,indeterminate:!1,done:m,total:h,coreIndex:g.coreIndex,coreCount:g.coreCount,coreDone:g.coreTotal,coreTotal:g.coreTotal},!0),await d(0)}return{candidatesPerCore:p,totalGenAll:h,doneCombos:m}}async function y(t){let{cores:e,pool:o,role:r,weights:n,perCoreLimit:l,emit:i}=t;const s=e.map((t,e)=>e),c=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,o=0;return function(r){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const l=f();(n||l-o>=e)&&(o=l,t(r))}}(i,24),{candidatesPerCore:a}=await S({cores:e,pool:o,role:r,weights:n,perCoreLimit:l,emitOverall:c}),u=a;let d=0;const g=function(){d++,c({type:"progress",phase:"search",label:"\ucd5c\uc801 \ubc30\uce58 \ud0d0\uc0c9 \uc911\u2026",indeterminate:!0,pulse:d},arguments.length>0&&void 0!==arguments[0]&&arguments[0])};g(!0);const v={list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0};function y(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set,r=null;const n=new Set;return function l(i,c,a,f,d,v,S,y){var P;if(g(),i===s.length){for(const r of t){var T;const t=null!==(T=e[r].minThreshold)&&void 0!==T?T:m(e[r].grade);if(h(c[r])<t)return}const o={picks:c.map(t=>t),sumThr:a,sumPoint:f,sumWill:d,roleSum:v,thrVec:S.slice(),ptVec:y.slice()};return void(((t,e)=>{if(!e)return!0;if(t.sumThr!==e.sumThr)return t.sumThr>e.sumThr;for(let o=0;o<t.thrVec.length;o++)if(t.thrVec[o]!==e.thrVec[o])return t.thrVec[o]>e.thrVec[o];if(t.sumPoint!==e.sumPoint)return t.sumPoint>e.sumPoint;for(let o=0;o<t.ptVec.length;o++)if(t.ptVec[o]!==e.ptVec[o])return t.ptVec[o]>e.ptVec[o];return t.roleSum!==e.roleSum?t.roleSum>e.roleSum:t.sumWill!==e.sumWill&&t.sumWill<e.sumWill})(o,r)&&(r=o))}const w=s[i],b=t.has(w),k=b?null!==(P=e[w].minThreshold)&&void 0!==P?P:m(e[w].grade):-1/0;if(o.has(w))return void l(i+1,c,a,f,d,v,S,y);const x=u[i]||[];for(const t of x){const e=h(t);if(b&&e<k)continue;if(p(t,n))continue;t.list.forEach(t=>n.add(t.id));const o=c[w];c[w]=t,S[i]=e,y[i]=t.totalPoint,l(i+1,c,a+e,f+t.totalPoint,d+t.totalWill,v+t.roleSum,S,y),t.list.forEach(t=>n.delete(t.id)),c[w]=o,S[i]=0,y[i]=0}b||l(i+1,c,a,f,d,v,S,y)}(0,e.map(()=>v),0,0,0,0,Array(s.length).fill(0),Array(s.length).fill(0)),r}const P=e.map((t,e)=>t.enforceMin?e:-1).filter(t=>-1!==t),T=new Set(P),w=y(T);if(w)return{picks:w.picks};if(s.length>0){const t=s[s.length-1];if(T.has(t)){const e=y(new Set([...T].filter(e=>e!==t)),new Set([t]));if(e){return{picks:e.picks.map((e,o)=>o===t?v:e||v)}}}}const b=new Set;for(const f of P){var k;const t=null!==(k=e[f].minThreshold)&&void 0!==k?k:m(e[f].grade),o=s.indexOf(f);(u[o]||[]).some(e=>h(e)>=t)||b.add(f)}const x=y(new Set(P.filter(t=>!b.has(t))));if(x){return{picks:x.picks.map((t,e)=>b.has(e)?v:t||v)}}return{picks:e.map(()=>v)}}globalThis.onmessage=async t=>{const{type:e="run",cores:o,gems:r,role:n,weights:l,perCoreLimit:s}=t.data,c=t=>globalThis.postMessage(t);try{if("kickoff"===e)return;c({type:"result",...await y({cores:o,pool:r,role:n,weights:i(l),perCoreLimit:s,emit:c})})}catch(a){console.error("Worker error:",a),c({type:"error",error:String((null===a||void 0===a?void 0:a.message)||a)})}}})();
//# sourceMappingURL=290.d15ac34f.chunk.js.map