(()=>{"use strict";const t={HERO:7,LEGEND:11,RELIC:15,ANCIENT:17},e={HERO:[10],LEGEND:[10,14],RELIC:[10,14,17,18,19,20],ANCIENT:[10,14,17,18,19,20]},o={dealer:new Set(["atk","add","boss"]),support:new Set(["brand","allyDmg","allyAtk"])},l={atk:1,add:1,boss:1,brand:1,allyDmg:1,allyAtk:1};function r(t){const e={...l};return t?(Object.keys(e).forEach(o=>{const r=t[o],n="number"===typeof r?r:Number(r);e[o]=Number.isFinite(n)&&n>=0?n:l[o]}),e):e}function*n(t,e){const o=t.length;if(e>o)return;const l=Array.from({length:e},(t,e)=>e);for(;;){yield l.map(e=>t[e]);let r=e-1;for(;r>=0&&l[r]===o-e+r;)r--;if(r<0)break;l[r]++;for(let t=r+1;t<e;t++)l[t]=l[t-1]+1}}function i(t,l,r,n){const i=t.reduce((t,e)=>{var o;return t+(null!==(o=e.will)&&void 0!==o?o:0)},0),s=t.reduce((t,e)=>{var o;return t+(null!==(o=e.point)&&void 0!==o?o:0)},0),u=function(t,o){return e[t].filter(t=>o>=t)}(l,s),c=t.reduce((t,e)=>t+function(t,e,l){var r,n,i,s;if(null==e)return 0;const u="dealer"===e?o.dealer:o.support;return(u.has(t.o1k)?(null!==(r=t.o1v)&&void 0!==r?r:0)*(null!==(n=l[t.o1k])&&void 0!==n?n:1):0)+(u.has(t.o2k)?(null!==(i=t.o2v)&&void 0!==i?i:0)*(null!==(s=l[t.o2k])&&void 0!==s?s:1):0)}(e,r,n),0);return{totalWill:i,totalPoint:s,thr:u,roleSum:c,score:1e7*u.length+1e4*s+10*(5e3-i)+c-t.length}}function s(o,l,s,u,c,a,d){const h=t[l],m=r(u),f=Math.min(...e[l]),p=null!==c&&void 0!==c?c:f,g=a||null==c,v=[],S=Math.min(4,o.length);for(let t=0;t<=S;t++)if(0!==t)for(const e of n(o,t)){d&&d(1);const t=e.reduce((t,e)=>t+(e.will||0),0);if(t>h)continue;const{totalPoint:o,thr:r,roleSum:n,score:u}=i(e,l,s,m);v.push({list:e,totalWill:t,totalPoint:o,thr:r,roleSum:n,score:u})}else v.push({list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0});let P;return v.sort((t,e)=>e.score-t.score),P=g?v.filter(t=>{const e=Math.max(0,...t.thr);return t.list.length>0&&e>=(null!==p&&void 0!==p?p:0)}):v.filter(t=>t.list.length>0&&t.thr.length>0),0===P.length?[{list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0}]:P}const u=t=>{var e;return null!==t&&void 0!==t&&null!==(e=t.thr)&&void 0!==e&&e.length?Math.max(...t.thr):0},c=t=>Math.min(...e[t]);function a(t,e){for(const o of t.list)if(e.has(o.id))return!0;return!1}function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,o=0;return function(l){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(()=>{var t,e,o;return null!==(t=null===(e=globalThis.performance)||void 0===e||null===(o=e.now)||void 0===o?void 0:o.call(e))&&void 0!==t?t:Date.now()})();(r||n-o>=e)&&(o=n,t(l))}}function h(t){let{cores:e,pool:o,role:l,weights:r,perCoreLimit:n,emitOverall:i}=t;const c=o.length,a=Math.min(4,c),d=Array.from({length:a},(t,e)=>((t,e)=>{let o=1;for(let l=1;l<=e;l++)o=o*(t-l+1)/l;return Math.floor(o)})(c,e+1)).reduce((t,e)=>t+e,0);let h=0;return{candidatesPerCore:e.map(t=>s(o,t.grade,l,r,void 0,!1,()=>{h+=1}).filter(t=>t.list.length>0&&t.thr.length>0).sort((t,e)=>{const o=u(t),l=u(e);return o!==l?l-o:t.totalPoint!==e.totalPoint?e.totalPoint-t.totalPoint:t.roleSum!==e.roleSum?e.roleSum-t.roleSum:t.totalWill-e.totalWill}).slice(0,Math.max(n,1e4))),totalCombos:d,doneCombos:h}}function m(t){let{cores:e,pool:o,role:l,weights:r,perCoreLimit:n,emit:i}=t;const s=e.map((t,e)=>e),m=new Set(e.map((t,e)=>t.enforceMin?e:-1).filter(t=>-1!==t)),f=d(i,8),{candidatesPerCore:p,totalCombos:g,doneCombos:v}=h({cores:e,pool:o,role:l,weights:r,perCoreLimit:n,emitOverall:f}),S=function(t){let{cores:e,order:o,enforcedSet:l,candidatesPerCore:r}=t,n=0;const i=new Set;return function t(s,d){if(s===o.length)return;const h=o[s],m=l.has(h),f=m?null!==(d=e[h].minThreshold)&&void 0!==d?d:c(e[h].grade):-1/0,p=r[h];for(const e of p){const o=u(e);m&&o<f||a(e,i)||(n+=1,e.list.forEach(t=>i.add(t.id)),t(s+1),e.list.forEach(t=>i.delete(t.id)))}m||(n+=1,t(s+1))}(0),n}({cores:e,order:s,enforcedSet:m,candidatesPerCore:p}),P=g+S;f({type:"progress",label:"\ud6c4\ubcf4 \uc0dd\uc131 \uc815\ub9ac \uc911\u2026",done:v,total:P},!0);const b={list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0},y=(t,e)=>{if(!e)return!0;if(t.sumThr!==e.sumThr)return t.sumThr>e.sumThr;for(let o=0;o<t.thrVec.length;o++)if(t.thrVec[o]!==e.thrVec[o])return t.thrVec[o]>e.thrVec[o];if(t.sumPoint!==e.sumPoint)return t.sumPoint>e.sumPoint;for(let o=0;o<t.ptVec.length;o++)if(t.ptVec[o]!==e.ptVec[o])return t.ptVec[o]>e.ptVec[o];return t.roleSum!==e.roleSum?t.roleSum>e.roleSum:t.sumWill!==e.sumWill&&t.sumWill<e.sumWill};let C=null;const E=new Set;let W=0;return function t(o,l,r,n,i){if(o===s.length)return;const d=s[o],h=m.has(d),g=h?null!==(i=e[d].minThreshold)&&void 0!==i?i:c(e[d].grade):-1/0,S=p[d];for(const p of S){const i=u(p);if(h&&i<g)continue;if(a(p,E))continue;W+=1,f({type:"progress",label:"\ucd5c\uc801 \ubc30\uce58 \ud0d0\uc0c9 \uc911\u2026",done:v+W,total:P}),p.list.forEach(t=>E.add(t.id));const S=l[d];if(l[d]=p,r[o]=i,n[o]=p.totalPoint,o+1===s.length){let t=!0;if(m.forEach(o=>{var r;u(l[o])<(null!==(r=e[o].minThreshold)&&void 0!==r?r:c(e[o].grade))&&(t=!1)}),t){const t={picks:l.map(t=>t||b),sumThr:r.reduce((t,e)=>t+e,0),sumPoint:n.reduce((t,e)=>t+e,0),sumWill:l.reduce((t,e)=>t+((null===e||void 0===e?void 0:e.totalWill)||0),0),roleSum:l.reduce((t,e)=>t+((null===e||void 0===e?void 0:e.roleSum)||0),0),thrVec:r.slice(),ptVec:n.slice()};y(t,C)&&(C=t)}}else t(o+1,l,r,n);p.list.forEach(t=>E.delete(t.id)),l[d]=S,r[o]=0,n[o]=0}if(!h)if(W+=1,f({type:"progress",label:"\ucd5c\uc801 \ubc30\uce58 \ud0d0\uc0c9 \uc911\u2026",done:v+W,total:P}),o+1===s.length){const t={picks:l.map(t=>t||b),sumThr:r.reduce((t,e)=>t+e,0),sumPoint:n.reduce((t,e)=>t+e,0),sumWill:l.reduce((t,e)=>t+((null===e||void 0===e?void 0:e.totalWill)||0),0),roleSum:l.reduce((t,e)=>t+((null===e||void 0===e?void 0:e.roleSum)||0),0),thrVec:r.slice(),ptVec:n.slice()};y(t,C)&&(C=t)}else t(o+1,l,r,n)}(0,e.map(()=>b),Array(s.length).fill(0),Array(s.length).fill(0)),{picks:C?C.picks:e.map(()=>b)}}globalThis.onmessage=t=>{const{cores:e,gems:o,role:l,weights:n,perCoreLimit:i}=t.data,s=t=>globalThis.postMessage(t);try{s({type:"progress",label:"\uc900\ube44 \uc911\u2026",done:0,total:1});s({type:"result",...m({cores:e,pool:o,role:l,weights:r(n),perCoreLimit:i,emit:s})})}catch(u){s({type:"error",error:String((null===u||void 0===u?void 0:u.message)||u)})}}})();
//# sourceMappingURL=290.5d94d426.chunk.js.map