(()=>{"use strict";var t={4141:(t,a,e)=>{var n=e(1257),i=e.n(n);const o=(t,a)=>{"error"===t&&a instanceof Error?postMessage({type:t,payload:{code:a.code||"UNKNOWN",message:a.message,stack:a.stack}}):postMessage({type:t,payload:a})};async function r(t){const a=new OffscreenCanvas(t.width,t.height),e=a.getContext("2d",{alpha:!1});return e.imageSmoothingEnabled=!1,e.drawImage(t,0,0),await a.convertToBlob({type:"image/png",quality:.95})}async function l(t,a,e,n,i){const o=Math.max(1,Math.round(n)),r=Math.max(1,Math.round(i)),l=new OffscreenCanvas(o,r),s=l.getContext("2d",{alpha:!1});s.imageSmoothingEnabled=!1,s.drawImage(t,a,e,n,i,0,0,o,r);const h=await l.convertToBlob({type:"image/png",quality:.95});return{blob:h,url:URL.createObjectURL(h),W:o,H:r,canvas:l,ctx:s}}async function s(t){let{invert:a=!0,boostWhiteByS:e=!1,satThresh:n=.18,vThresh:i=.8,softness:o=50,up:r=2,levels:l=null,bgSuppress:s={enabled:!1,satMin:.12,vMax:.92,dist:38,smooth:0,sampleRect:null}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=t.width,c=t.height,d=new OffscreenCanvas(h*r,c*r),u=d.getContext("2d",{willReadFrequently:!0});if(u.imageSmoothingEnabled=!1,u.drawImage(t,0,0,h,c,0,0,d.width,d.height),l&&Number.isFinite(l.inBlack)&&Number.isFinite(l.inWhite)&&Number.isFinite(l.gamma)){const t=Math.max(0,Math.min(255,0|l.inBlack)),a=Math.max(0,Math.min(255,0|l.inWhite)),e=Math.max(.01,l.gamma),n=Number.isFinite(l.outBlack)?Math.max(0,Math.min(255,0|l.outBlack)):0,i=Number.isFinite(l.outWhite)?Math.max(0,Math.min(255,0|l.outWhite)):255,o=Math.max(1,a-t),r=u.getImageData(0,0,d.width,d.height),s=r.data;for(let l=0;l<s.length;l+=4){for(let a=0;a<3;a++){let r=(s[l+a]-t)/o;r=Math.max(0,Math.min(1,r)),r=Math.pow(r,1/e),s[l+a]=n+r*(i-n)|0}s[l+3]=255}u.putImageData(r,0,0)}if(null!==s&&void 0!==s&&s.enabled){var m,g,v,f,w,x,p,M,b,y,B,O;const t=u.getImageData(0,0,d.width,d.height),a=t.data,e=(t,a,e)=>{const n=t/255,i=a/255,o=e/255,r=Math.max(n,i,o),l=r-Math.min(n,i,o);let s=0;0!==l&&(s=r===n?(i-o)/l%6:r===i?(o-n)/l+2:(n-i)/l+4,s/=6,s<0&&(s+=1));return[s,0===r?0:l/r,r]},n=null!==(m=null===(g=s.sampleRect)||void 0===g?void 0:g.x)&&void 0!==m?m:0,i=null!==(v=null===(f=s.sampleRect)||void 0===f?void 0:f.y)&&void 0!==v?v:0,o=null!==(w=null===(x=s.sampleRect)||void 0===x?void 0:x.w)&&void 0!==w?w:d.width,r=null!==(p=null===(M=s.sampleRect)||void 0===M?void 0:M.h)&&void 0!==p?p:d.height;let l=0,h=0,c=0,k=0;const R=Math.max(0,Math.min(1,null!==(b=s.satMin)&&void 0!==b?b:.12)),I=Math.max(0,Math.min(1,null!==(y=s.vMax)&&void 0!==y?y:.92));for(let s=i;s<i+r;s+=2)for(let t=n;t<n+o;t+=2){const n=4*(s*d.width+t),i=a[n],o=a[n+1],r=a[n+2],[,u,m]=e(i,o,r);u>=R&&m<=I&&(l+=i,h+=o,c+=r,k++)}const W=k?l/k:0,N=k?h/k:0,S=k?c/k:0,L=Math.max(0,Math.min(441,null!==(B=s.dist)&&void 0!==B?B:38)),P=Math.max(0,null!==(O=s.smooth)&&void 0!==O?O:0),T=(t,a,e)=>{const n=t-W,i=a-N,o=e-S;return Math.sqrt((.9*n)**2+(1.1*i)**2+(1*o)**2)};for(let s=0;s<a.length;s+=4){const t=a[s],e=a[s+1],n=a[s+2],i=T(t,e,n);if(P<=0)i<=L&&(a[s]=a[s+1]=a[s+2]=0);else{const o=1-(i<=L?0:i>=L+P?1:(i-L)/P);o>0&&(a[s]=Math.round(t*(1-o)),a[s+1]=Math.round(e*(1-o)),a[s+2]=Math.round(n*(1-o)))}a[s+3]=255}u.putImageData(t,0,0)}let k=null;if(e){const t=u.getImageData(0,0,d.width,d.height).data;k=new Uint8Array(d.width*d.height);const a=(t,a,e)=>{const n=t/255,i=a/255,o=e/255,r=Math.max(n,i,o),l=r-Math.min(n,i,o);let s=0;0!==l&&(s=r===n?(i-o)/l%6:r===i?(o-n)/l+2:(n-i)/l+4,s/=6,s<0&&(s+=1));return[s,0===r?0:l/r,r]};for(let e=0,o=0;e<t.length;e+=4,o++){const r=t[e],l=t[e+1],s=t[e+2],[,h,c]=a(r,l,s);k[o]=h<=n&&c>=i?1:0}}const R=u.getImageData(0,0,d.width,d.height),I=R.data;for(let C=0;C<I.length;C+=4){const t=.299*I[C]+.587*I[C+1]+.114*I[C+2];I[C]=I[C+1]=I[C+2]=t}if(a)for(let C=0;C<I.length;C+=4)I[C]=I[C+1]=I[C+2]=255-I[C];const W=new Array(256).fill(0);for(let C=0;C<I.length;C+=4)W[0|I[C]]++;const N=d.width*d.height;let S=0;for(let C=0;C<256;C++)S+=C*W[C];let L=0,P=0,T=0,_=127;for(let C=0;C<256;C++){if(P+=W[C],!P)continue;const t=N-P;if(!t)break;L+=C*W[C];const a=P*t*(L/P-(S-L)/t)**2;a>T&&(T=a,_=C)}for(let C=0;C<I.length;C+=4){const t=I[C]-_,a=Math.abs(t)>=o?t>0?255:0:Math.round((t+o)/(2*o)*255);I[C]=I[C+1]=I[C+2]=a,I[C+3]=255}if(e&&k){const t=a?0:255;for(let a=0,e=0;a<k.length;a++,e+=4)k[a]&&(I[e]=I[e+1]=I[e+2]=t,I[e+3]=255)}u.putImageData(R,0,0);const j=await d.convertToBlob({type:"image/png",quality:1});return await createImageBitmap(j)}async function h(t,a,e,n){let{psm:o=7,whitelist:r=""}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const l={tessedit_pageseg_mode:o,preserve_interword_spaces:"1",logger:t=>{"recognizing text"===t.status&&"number"===typeof t.progress&&(null===n||void 0===n||n(`${e}\u2026`,!1,Math.round(100*t.progress)))}};r&&(l.tessedit_char_whitelist=r);const{data:s}=await i().recognize(t,a,l),h=[],c=t=>{var a,e,n,i,o,r,l,s,c,d,u,m,g,v;if(null===t||void 0===t||!t.text||null===t||void 0===t||!t.bbox)return;const f=String(t.text).trim();if(!f)return;const w={x:null!==(a=null===(e=t.bbox)||void 0===e?void 0:e.x0)&&void 0!==a?a:0,y:null!==(n=null===(i=t.bbox)||void 0===i?void 0:i.y0)&&void 0!==n?n:0,w:(null!==(o=null===(r=t.bbox)||void 0===r?void 0:r.x1)&&void 0!==o?o:0)-(null!==(l=null===(s=t.bbox)||void 0===s?void 0:s.x0)&&void 0!==l?l:0),h:(null!==(c=null===(d=t.bbox)||void 0===d?void 0:d.y1)&&void 0!==c?c:0)-(null!==(u=null===(m=t.bbox)||void 0===m?void 0:m.y0)&&void 0!==u?u:0)},x=null!==(g=null!==(v=t.confidence)&&void 0!==v?v:t.conf)&&void 0!==g?g:null;h.push({text:f,bbox:w,conf:x})};if(Array.isArray(null===s||void 0===s?void 0:s.words))for(const i of s.words)c(i);return{words:h,rawText:(null===s||void 0===s?void 0:s.text)||""}}function c(t,a){const e=t.x+t.w,n=t.y+t.h,i=a.x+a.w,o=a.y+a.h,r=Math.max(t.x,a.x),l=Math.max(t.y,a.y),s=Math.min(e,i),h=Math.min(n,o),c=Math.max(0,s-r)*Math.max(0,h-l),d=t.w*t.h+a.w*a.h-c;return d>0?c/d:0}function d(t){let{iouThresh:a=.6}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=[];for(const n of t||[])e.find(t=>t.text===n.text&&c(t.bbox,n.bbox)>=a)||e.push(n);return e}async function u(t,a,e){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const i=t.width,o=t.height,c=await createImageBitmap(await t.convertToBlob({type:"image/png",quality:.95}));let u=function(t,a){const e=((arguments.length>2&&void 0!==arguments[2]?arguments[2]:[])||[]).filter(t=>t&&t.w>2&&t.h>2);if(!e.length)return null;const n=Math.max(0,Math.min(...e.map(t=>t.x))),i=Math.min(t-1,Math.max(...e.map(t=>t.x+t.w))),o=Math.round(Math.max(4,Math.min(24,.01*t))),r=Math.min(t-1,Math.max(n+1,i+o)),l=Math.max(20,Math.min(r-1,n));return{leftW:l,rightX:r,rightW:Math.max(10,t-r),gapX:r-l}}(i,o,n);if(!u){const t=Math.max(20,Math.round(.22*i)),a=Math.round(.06*i),e=Math.min(i-1,t+a);u={leftW:t,rightX:e,rightW:Math.max(10,i-e),gapX:a,_fallback:!0}}const{leftW:m,rightX:g,rightW:v}=u,{blob:f}=await l(c,0,0,m,o),{blob:w}=await l(c,g,0,v,o),x=await s(await createImageBitmap(f),{invert:!0,boostWhiteByS:!0,satThresh:0,vThresh:1,softness:80,levels:{inBlack:30,gamma:.75,inWhite:220,outBlack:0,outWhite:255},bgSuppress:{enabled:!0,satMin:.12,vMax:1,dist:200,smooth:0}}),p=await s(await createImageBitmap(w),{invert:!0}),M=URL.createObjectURL(await r(x)),b=URL.createObjectURL(await r(p));let y=[],B=[],O="",k="";try{const t=await h(M,a,"\uc67c\ucabd(\uc22b\uc790)",e,{psm:7,whitelist:"0123456789"});y=t.words||[],O=t.rawText||"";const n=await h(b,"kor","\uc624\ub978\ucabd(\ub77c\ubca8/Lv)",e,{psm:7,whitelist:"0123456789.Lv\uacf5\uaca9\ub825\ucd94\uac00\ud53c\ud574\ubcf4\uc2a4\ud53c\ud574\uc544\uad70\uacf5\uaca9\uac15\ud654\uc544\uad70\ud53c\ud574\uac15\ud654\ub099\uc778\ub825"});B=n.words||[],k=n.rawText||""}finally{URL.revokeObjectURL(M),URL.revokeObjectURL(b)}const R=d([...y,...(I=d(B),W=g,(I||[]).map(t=>({text:t.text,bbox:{x:t.bbox.x+W,y:t.bbox.y,w:t.bbox.w,h:t.bbox.h},conf:t.conf})))]);var I,W;const N=await(await r(x)).arrayBuffer(),S=await(await r(p)).arrayBuffer();return{words:R,leftRaw:O,rightRaw:k,debug:{bands:{W:i,H:o,...u}},previews:{leftPrePng:N,rightPrePng:S,leftSize:{w:x.width,h:x.height},rightSize:{w:p.width,h:p.height}}}}self.onmessage=async t=>{const{type:a,payload:e}=t.data||{};if("scan"!==a)return;const{buf:n,mime:i="image/png",lang:r="kor+eng",rect:s,excludes:h=[]}=e||{};if(!n)return o("error",{code:"NO_IMAGE",message:"no image buffer"});if(!s||!Number.isFinite(s.x)||!Number.isFinite(s.y)||!Number.isFinite(s.w)||!Number.isFinite(s.h))return o("error",{code:"NO_ROI",message:"manual ROI(rect) is required"});let c;try{c=await createImageBitmap(new Blob([n],{type:i}))}catch(f){return o("error",{code:"DECODE_FAIL",message:"\uc774\ubbf8\uc9c0\ub97c \ub514\ucf54\ub4dc\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",detail:String(f)})}try{var d,m;const t=c.width,a=c.height,e={x:Math.max(0,Math.min(t-1,Math.round(s.x))),y:Math.max(0,Math.min(a-1,Math.round(s.y))),w:Math.max(1,Math.min(t,Math.round(s.w))),h:Math.max(1,Math.min(a,Math.round(s.h)))},n=await(async()=>{const e=new OffscreenCanvas(t,a);return e.getContext("2d",{alpha:!1}).drawImage(c,0,0),await e.convertToBlob({type:"image/png",quality:.95})})(),i=await async function(t,a){const e=t instanceof ImageBitmap?t:await createImageBitmap(t),{x:n,y:i,w:o,h:r}=a;return await l(e,n,i,o,r)}(n,e),g=(h||[]).map(t=>({x:t.x-e.x,y:t.y-e.y,w:t.w,h:t.h}));await async function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(null===a||void 0===a||!a.length)return;const e=t.getContext("2d",{alpha:!1});e.save(),e.fillStyle="#000",a.forEach(t=>{if(!t)return;const a=Math.max(0,Math.round(t.x)),n=Math.max(0,Math.round(t.y)),i=Math.max(1,Math.round(t.w)),o=Math.max(1,Math.round(t.h));e.fillRect(a,n,i,o)}),e.restore()}(i.canvas,g);const v=(t,a,e)=>o("progress",{label:t,indeterminate:!!a,pct:null!==e&&void 0!==e?e:0}),f=await u(i.canvas,r,v,g),w=await i.canvas.convertToBlob({type:"image/png",quality:.95}),x=await w.arrayBuffer(),p=await i.blob.arrayBuffer(),M=[p,x,null===f||void 0===f||null===(d=f.previews)||void 0===d?void 0:d.leftPrePng,null===f||void 0===f||null===(m=f.previews)||void 0===m?void 0:m.rightPrePng].filter(Boolean);postMessage({type:"done",payload:{ok:!0,anchor:null,panel:{...e,by:"manual"},imageSize:{w:i.W,h:i.H},words:f.words,joinedWords:(f.words||[]).map(t=>t.text).join(" "),rawLeft:f.leftRaw,rawRight:f.rightRaw,roiPng:p,roiPrePng:x,roiMime:"image/png",debug:f.debug,previews:f.previews}},M)}catch(f){o("error",{code:(null===f||void 0===f?void 0:f.code)||"UNKNOWN",message:(null===f||void 0===f?void 0:f.message)||String(f),stack:null===f||void 0===f?void 0:f.stack})}finally{try{var g,v;null===(g=(v=c).close)||void 0===g||g.call(v)}catch{}}}}},a={};function e(n){var i=a[n];if(void 0!==i)return i.exports;var o=a[n]={exports:{}};return t[n].call(o.exports,o,o.exports,e),o.exports}e.m=t,e.x=()=>{var t=e.O(void 0,[257],()=>e(4141));return t=e.O(t)},(()=>{var t=[];e.O=(a,n,i,o)=>{if(!n){var r=1/0;for(c=0;c<t.length;c++){n=t[c][0],i=t[c][1],o=t[c][2];for(var l=!0,s=0;s<n.length;s++)(!1&o||r>=o)&&Object.keys(e.O).every(t=>e.O[t](n[s]))?n.splice(s--,1):(l=!1,o<r&&(r=o));if(l){t.splice(c--,1);var h=i();void 0!==h&&(a=h)}}return a}o=o||0;for(var c=t.length;c>0&&t[c-1][2]>o;c--)t[c]=t[c-1];t[c]=[n,i,o]}})(),e.n=t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a:a}),a},e.d=(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},e.f={},e.e=t=>Promise.all(Object.keys(e.f).reduce((a,n)=>(e.f[n](t,a),a),[])),e.u=t=>"static/js/"+t+".59e4d394.chunk.js",e.miniCssF=t=>{},e.o=(t,a)=>Object.prototype.hasOwnProperty.call(t,a),e.p="/",(()=>{var t={141:1,522:1};e.f.i=(a,n)=>{t[a]||importScripts(e.p+e.u(a))};var a=self.webpackChunkpeon_calculator=self.webpackChunkpeon_calculator||[],n=a.push.bind(a);a.push=a=>{var i=a[0],o=a[1],r=a[2];for(var l in o)e.o(o,l)&&(e.m[l]=o[l]);for(r&&r(e);i.length;)t[i.pop()]=1;n(a)}})(),(()=>{var t=e.x;e.x=()=>e.e(257).then(t)})();e.x()})();
//# sourceMappingURL=141.6d9d69e7.chunk.js.map