(()=>{"use strict";const t={HERO:7,LEGEND:11,RELIC:15,ANCIENT:17},e={HERO:[10],LEGEND:[10,14],RELIC:[10,14,17,18,19,20],ANCIENT:[10,14,17,18,19,20]},l={dealer:new Set(["atk","add","boss"]),support:new Set(["brand","allyDmg","allyAtk"])},o={atk:1,add:1,boss:1,brand:1,allyDmg:1,allyAtk:1};function r(t){const e={...o};return t?(Object.keys(e).forEach(l=>{const r=t[l],n="number"===typeof r?r:Number(r);e[l]=Number.isFinite(n)&&n>=0?n:o[l]}),e):e}function*n(t,e){const l=t.length;if(e>l)return;const o=Array.from({length:e},(t,e)=>e);for(;;){yield o.map(e=>t[e]);let r=e-1;for(;r>=0&&o[r]===l-e+r;)r--;if(r<0)break;o[r]++;for(let t=r+1;t<e;t++)o[t]=o[t-1]+1}}function i(t,o,r,n){const i=t.reduce((t,e)=>{var l;return t+(null!==(l=e.will)&&void 0!==l?l:0)},0),s=t.reduce((t,e)=>{var l;return t+(null!==(l=e.point)&&void 0!==l?l:0)},0),u=function(t,l){return e[t].filter(t=>l>=t)}(o,s),c=t.reduce((t,e)=>t+function(t,e,o){var r,n,i,s;if(null==e)return 0;const u="dealer"===e?l.dealer:l.support;return(u.has(t.o1k)?(null!==(r=t.o1v)&&void 0!==r?r:0)*(null!==(n=o[t.o1k])&&void 0!==n?n:1):0)+(u.has(t.o2k)?(null!==(i=t.o2v)&&void 0!==i?i:0)*(null!==(s=o[t.o2k])&&void 0!==s?s:1):0)}(e,r,n),0);return{totalWill:i,totalPoint:s,thr:u,roleSum:c,score:1e7*u.length+1e4*s+10*(5e3-i)+c-t.length}}function s(l,o,s,u){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:300;const a=r(u),h=t=>Math.min(...(t=>e[t])(t)),f=t=>{var e;return null!==t&&void 0!==t&&null!==(e=t.thr)&&void 0!==e&&e.length?Math.max(...t.thr):0},m={list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0},d=l.map((t,e)=>e),g=l.map((t,e)=>t.enforceMin?e:-1).filter(t=>-1!==t),p=(l,o)=>{const u=function(l,o,s,u,c,a){const h=t[o],f=r(u),m=Math.min(...e[o]),d=null!==c&&void 0!==c?c:m,g=a||null==c,p=[],v=Math.min(4,l.length);for(let t=0;t<=v;t++)if(0!==t)for(const e of n(l,t)){const t=e.reduce((t,e)=>t+(e.will||0),0);if(t>h)continue;const{totalPoint:l,thr:r,roleSum:n,score:u}=i(e,o,s,f);p.push({list:e,totalWill:t,totalPoint:l,thr:r,roleSum:n,score:u})}else p.push({list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0});let S;return p.sort((t,e)=>e.score-t.score),S=g?p.filter(t=>{const e=Math.max(0,...t.thr);return t.list.length>0&&e>=(null!==d&&void 0!==d?d:0)}):p.filter(t=>t.list.length>0&&t.thr.length>0),0===S.length?[{list:[],totalWill:0,totalPoint:0,thr:[],roleSum:0,score:0}]:S}(o,l.grade,s,a,void 0,!1).filter(t=>t.list.length>0&&t.thr.length>0);return u.sort((t,e)=>{const l=f(t),o=f(e);return l!==o?o-l:t.totalPoint!==e.totalPoint?e.totalPoint-t.totalPoint:t.roleSum!==e.roleSum?e.roleSum-t.roleSum:t.totalWill-e.totalWill}),u.slice(0,Math.max(c,1e4))},v=d.map(t=>p(l[t],o));function S(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set,o=null;const r=new Set;return function n(i,s,u,c,a,m,g,p){var S;if(i===d.length){for(const o of t){var k;const t=null!==(k=l[o].minThreshold)&&void 0!==k?k:h(l[o].grade);if(f(s[o])<t)return}const e={picks:s.map(t=>t),sumThr:u,sumPoint:c,sumWill:a,roleSum:m,thrVec:g.slice(),ptVec:p.slice()};return void(function(t,e){if(!e)return!0;if(t.sumThr!==e.sumThr)return t.sumThr>e.sumThr;for(let l=0;l<t.thrVec.length;l++)if(t.thrVec[l]!==e.thrVec[l])return t.thrVec[l]>e.thrVec[l];if(t.sumPoint!==e.sumPoint)return t.sumPoint>e.sumPoint;for(let l=0;l<t.ptVec.length;l++)if(t.ptVec[l]!==e.ptVec[l])return t.ptVec[l]>e.ptVec[l];return t.roleSum!==e.roleSum?t.roleSum>e.roleSum:t.sumWill!==e.sumWill&&t.sumWill<e.sumWill}(e,o)&&(o=e))}const P=d[i],E=t.has(P),W=E?null!==(S=l[P].minThreshold)&&void 0!==S?S:h(l[P].grade):-1/0;if(e.has(P))return void n(i+1,s,u,c,a,m,g,p);const b=v[i];for(const t of b){const e=f(t);if(E&&e<W)continue;let l=!1;for(const n of t.list)if(r.has(n.id)){l=!0;break}if(l)continue;t.list.forEach(t=>r.add(t.id));const o=s[P];s[P]=t,g[i]=e,p[i]=t.totalPoint,n(i+1,s,u+e,c+t.totalPoint,a+t.totalWill,m+t.roleSum,g,p),t.list.forEach(t=>r.delete(t.id)),s[P]=o,g[i]=0,p[i]=0}E||n(i+1,s,u,c,a,m,g,p)}(0,l.map(()=>m),0,0,0,0,Array(d.length).fill(0),Array(d.length).fill(0)),o}const k=new Set(g),P=S(k);if(P)return{picks:P.picks};if(d.length>0){const t=d[d.length-1],e=S(new Set([...k].filter(e=>e!==t)),new Set([t]));if(e){return{picks:e.picks.map((e,l)=>l===t?m:e||m)}}}const E=new Set;for(const t of g){var W;const e=null!==(W=l[t].minThreshold)&&void 0!==W?W:h(l[t].grade),o=d.indexOf(t);(v[o]||[]).some(t=>f(t)>=e)||E.add(t)}const b=S(new Set(g.filter(t=>!E.has(t))));if(b){return{picks:b.picks.map((t,e)=>E.has(e)?m:t||m)}}return{picks:l.map(()=>m)}}globalThis.onmessage=t=>{const{cores:e,gems:l,role:o,weights:r,perCoreLimit:n}=t.data,i=s(e,l,o,r,n);globalThis.postMessage(i)}})();
//# sourceMappingURL=290.ea35cedd.chunk.js.map